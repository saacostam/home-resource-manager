import{j as t,S as l,D as y,q as b,s as C,t as E,M as S,Q as h,a2 as M,r as a,W as P,X as D,w as c,a3 as k,F as m,y as g,P as p,A as w,E as _,G as T,H as F}from"./index-hN6QEj4m.js";import{T as I}from"./TextInput-C4iTWAL6.js";import{A as Q}from"./Alert-DP2MxH_u.js";import{C as R,M as N,a as B,P as O}from"./modal-loader-D8fo-V8a.js";import{Q as j}from"./query-error-zqwJl0FX.js";import{a as A,b as v,c as K,u as U,B as q}from"./use-query-board-by-id-DikLOpW0.js";import{S as f,u as z}from"./Skeleton-L5MRzSN-.js";import{D as G}from"./Divider-D67SIWFC.js";import{E as H}from"./empty-query-CCE0tans.js";import{S as V}from"./Select-eLjaeruw.js";import{B as Y}from"./Breadcrumbs-CWjQaVpH.js";import{A as $}from"./Anchor-ChJvCUgj.js";function L({action:e,form:r,isPending:s,onSubmit:n}){var i,u;const o=r.formState.errors,d=(i=o.root)==null?void 0:i.message;return t.jsxs("form",{onSubmit:r.handleSubmit(n),children:[t.jsx(I,{size:"sm",label:"Name",placeholder:"Name",...r.register("name"),error:(u=o.name)==null?void 0:u.message}),d&&t.jsxs(t.Fragment,{children:[t.jsx(l,{h:"xl"}),t.jsx(Q,{color:"pink",title:d})]}),t.jsx(l,{h:"xl"}),t.jsxs(y,{type:"submit",w:"100%",loading:s,children:[e," Board"]})]})}function J(){const e=b(),{board:r}=C();return E({mutationKey:[S.POST_CREATE_BOARD],mutationFn:s=>r.createBoard(s),onSettled:()=>{e.invalidateQueries({queryKey:[h.GET_ALL_BOARDS]})}})}function W(){const e=b(),{board:r}=C();return E({mutationKey:[S.DELETE_BOARD],mutationFn:s=>r.deleteBoardById(s),onSettled:(s,n,{id:o})=>{e.invalidateQueries({queryKey:[h.GET_ALL_BOARDS]}),e.invalidateQueries({queryKey:[h.GET_BOARD_BY_ID,o]})}})}function X({onClose:e,setId:r}){const s=M({defaultValues:{name:""}}),n=J(),o=a.useCallback(d=>{n.mutate(d,{onSuccess:i=>{e(),r(i.id),c.show({color:"green",title:"Created",message:"Board created successfully"})},onError:i=>{if(!P(i)){s.setError("root",{message:"Something went wrong!"});return}D({axiosError:i,setError:s.setError})}})},[n,s,e,r]);return a.useMemo(()=>({form:s,onSubmit:o,isPending:n.isPending}),[n.isPending,s,o])}function Z({onClose:e,setId:r}){const{form:s,isPending:n,onSubmit:o}=X({onClose:e,setId:r});return t.jsx(L,{action:"Create",form:s,isPending:n,onSubmit:o})}function ee({id:e,onClose:r,setId:s}){const n=W(),o=a.useCallback(()=>{n.mutate({id:e},{onSuccess:()=>{s(null),c.show({color:"green",title:"Deleted",message:"Board deleted successfully"})},onError:()=>{c.show({color:"red",title:"Failed",message:"Couldn't delete board. Please try again shortly."})},onSettled:()=>{r()}})},[n,e,r,s]);return a.useMemo(()=>({isPending:n.isPending,onDelete:o}),[n.isPending,o])}function te({id:e,onClose:r,setId:s}){const{onDelete:n,isPending:o}=ee({id:e,onClose:r,setId:s});return t.jsx(R,{isCancelationPrimary:!0,isPending:o,mainLabel:"Delete",onCancel:r,onClickMain:n,verb:"delete this board"})}function re({id:e}){const r=A({args:{id:e}});return a.useMemo(()=>r.isLoading?{status:"loading"}:r.isSuccess?{status:"success",data:se(r.data)}:{status:"error",retry:{onClick:r.refetch,isPending:r.isPending}},[r.data,r.isLoading,r.isPending,r.isSuccess,r.refetch])}function se(e){return{id:e.id,content:e.content,name:e.name}}function ne({board:e,onClose:r}){const s=M({defaultValues:{name:e.name}}),n=v(),o=a.useCallback(d=>{n.mutate({id:e.id,name:d.name},{onSuccess:()=>{r(),c.show({color:"green",title:"Updated",message:"Board name updated successfully"})},onError:i=>{if(!P(i)){s.setError("root",{message:"Something went wrong!"});return}D({axiosError:i,setError:s.setError})}})},[e.id,s,r,n]);return a.useMemo(()=>({form:s,isPending:n.isPending,onSubmit:o}),[s,n.isPending,o])}function oe({board:e,onClose:r}){const{form:s,isPending:n,onSubmit:o}=ne({board:e,onClose:r});return t.jsx(L,{action:"Update",form:s,isPending:n,onSubmit:o})}function ae({id:e,onClose:r}){const{status:s,data:n,retry:o}=re({id:e});return s==="error"?t.jsx(j,{title:"Couldn't fetch board.",retry:o}):s==="success"?t.jsx(oe,{board:n,onClose:r}):t.jsx(N,{})}function ie(){const{mode:e,setMode:r,id:s,setId:n}=x(),o=a.useCallback(()=>{r({type:"browse"})},[r]);return t.jsxs(t.Fragment,{children:[t.jsx(B,{centered:!0,opened:e.type==="create",onClose:o,title:"Create Board",children:t.jsx(Z,{onClose:o,setId:n})}),t.jsx(B,{centered:!0,opened:e.type==="delete",onClose:o,title:"Delete Board",children:s&&t.jsx(te,{onClose:o,id:s,setId:n})}),t.jsx(B,{centered:!0,opened:e.type==="edit",onClose:o,title:"Edit Board",children:s&&t.jsx(ae,{onClose:o,id:s})})]})}function de(){const[e,r]=a.useState(null),[s,n]=a.useState({type:"browse"});return a.useMemo(()=>({id:e,mode:s,setMode:n,setId:r}),[e,s])}function ce({children:e}){return t.jsxs(k.Provider,{value:de(),children:[e,t.jsx(ie,{})]})}function x(){return a.useContext(k)}function ue(){const e=K(),{setMode:r}=x(),s=a.useCallback(()=>{r({type:"create"})},[r]);return a.useMemo(()=>e.isLoading?{status:"loading"}:e.isSuccess?{status:"success",data:le({res:e.data}),onCreateBoard:s}:{status:"error",retry:{isPending:e.isPending,onClick:e.refetch}},[e.data,e.isLoading,e.isPending,e.isSuccess,e.refetch,s])}function le(e){return e.res.boards.map(r=>({id:r.id,name:r.name}))}function me(){return t.jsxs(m,{direction:"column",gap:"sm","data-testid":"board-selector-skeleton",children:[t.jsx(f,{height:36}),t.jsx(f,{height:128})]})}function ge(){return t.jsx(f,{h:256})}function xe({board:e,updateBoardContent:r,onClickDelete:s,onClickEditName:n}){const{editor:o}=U({defaultContent:e.content,onUpdate:({editor:d})=>{r(d.getHTML())}});return t.jsxs(t.Fragment,{children:[t.jsx(G,{mb:"md"}),t.jsx(q,{editor:o}),t.jsx(l,{h:"xs"}),t.jsx(m,{gap:"sm",justify:"space-between",children:t.jsxs(m,{gap:"sm",children:[t.jsx("button",{onClick:s,style:{all:"unset",cursor:"pointer"},children:t.jsx(g,{size:"sm",c:"violet",td:"underline",children:"Delete"})}),t.jsx("button",{onClick:n,style:{all:"unset",cursor:"pointer"},children:t.jsx(g,{size:"sm",c:"violet",td:"underline",children:"Edit Name"})})]})})]})}const Be=500;function he({id:e}){const{setMode:r}=x(),s=A({args:{id:e}}),n=v(),o=z(u=>{n.mutate({id:e,content:u},{onError:()=>{c.show({color:"red",title:"Failed",message:"Unable to save board content. Some changes may not have been saved. Please try again shortly."})}})},Be),d=a.useCallback(()=>{r({type:"delete"})},[r]),i=a.useCallback(()=>{r({type:"edit"})},[r]);return a.useMemo(()=>s.isLoading?{status:"loading"}:s.isSuccess?{status:"success",data:fe({res:s.data}),updateBoardContent:o,onClickDelete:d,onClickEditName:i}:{status:"error",retry:{isPending:s.isPending,onClick:s.refetch}},[s.data,s.isLoading,s.isPending,s.isSuccess,s.refetch,o,d,i])}function fe(e){return{id:e.res.id,name:e.res.name,content:e.res.content}}function je({id:e}){const{status:r,data:s,retry:n,updateBoardContent:o,onClickDelete:d,onClickEditName:i}=he({id:e});return r==="error"?t.jsx(j,{title:"Couldn't fetch board.",retry:n}):r==="success"?t.jsx(xe,{board:s,updateBoardContent:o,onClickDelete:d,onClickEditName:i}):t.jsx(ge,{})}function pe({boards:e}){const{id:r,setId:s}=x();return t.jsxs("div",{"data-testid":"board-selector-content",children:[t.jsx(V,{size:"sm",placeholder:"Board",data:e.map(n=>({value:n.id,label:n.name})),value:r,onChange:n=>{s(n)},nothingFoundMessage:"Nothing found...",searchable:!0,clearable:!0}),t.jsx(l,{h:"lg"}),r?t.jsx("div",{children:t.jsx(je,{id:r})},r):t.jsx(H,{title:"Nothing Selected",description:"Please select a Board"})]})}function ye(){const{status:e,data:r,retry:s,onCreateBoard:n}=ue();return t.jsxs(t.Fragment,{children:[t.jsxs(m,{py:"md",align:"start",justify:"space-between",direction:{base:"column",sm:"row"},gap:"lg",children:[t.jsxs(p,{children:[t.jsx(w,{size:"h2",order:4,children:"Boards"}),t.jsx(g,{size:"sm",c:"gray",fw:500,children:"Jot down quick notes, ideas, and running lists"})]}),e==="success"&&t.jsx(y,{leftSection:t.jsx(O,{style:{width:"1.1rem",height:"1.1rem"}}),onClick:n,"data-testid":"create-board-button",children:"Create Board"})]}),t.jsx(p,{p:"md",withBorder:!0,children:e==="loading"?t.jsx(me,{}):e==="error"?t.jsx(j,{title:"Couldn't fetch boards.",retry:s}):t.jsx(pe,{boards:r})})]})}function be(){return t.jsx(ce,{children:t.jsx(ye,{})})}function Te(){return t.jsxs(t.Fragment,{children:[t.jsxs(Y,{children:[t.jsx($,{component:T,to:_({type:F.DASHBOARD}),children:"Dashboard"}),t.jsx(g,{c:"violet",children:"Boards"})]}),t.jsx(be,{})]})}export{Te as default};
