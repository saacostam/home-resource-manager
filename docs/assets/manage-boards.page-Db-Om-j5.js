import{j as e,S as m,C as y,v as C,w as E,M as S,Q as f,r as a,F as g,z as h,y as u,V as b,P as j,A as w,D as T,E as F,G as _}from"./index-Dc5gea9V.js";import{C as I,M as R,a as x,P as O}from"./modal-loader-4eYtvyNG.js";import{Q as p}from"./query-error-DnVkmsEU.js";import{c as Q,u as N,B as q,a as P,b as D,d as M}from"./use-put-update-board-by-id-IQokiB08.js";import{S as B,u as z}from"./Skeleton-D8hP01vJ.js";import{D as K}from"./Divider-DPy8Nueh.js";import{E as U}from"./empty-query-BfbWiOVP.js";import{S as G}from"./Select-C2YSWk7A.js";import{T as V}from"./TextInput-DrMuMtWx.js";import{A as $,a as k}from"./types-DM-qadrJ.js";import{h as A,A as H}from"./handle-api-errors-C5ts5Tjv.js";import{B as Y}from"./Breadcrumbs-Dqzgh2Qe.js";import"./get-base-value-JqT_q0U7.js";import"./clamp-DTmYCdls.js";import"./external-M-J_qBnQ.js";function v({action:t,form:r,isPending:s,onSubmit:n}){var i,l;const o=r.formState.errors,d=(i=o.root)==null?void 0:i.message;return e.jsxs("form",{onSubmit:r.handleSubmit(n),children:[e.jsx(V,{size:"sm",label:"Name",placeholder:"Name",...r.register("name"),error:(l=o.name)==null?void 0:l.message}),d&&e.jsxs(e.Fragment,{children:[e.jsx(m,{h:"xl"}),e.jsx($,{color:"pink",title:d})]}),e.jsx(m,{h:"xl"}),e.jsxs(y,{type:"submit",w:"100%",loading:s,children:[t," Board"]})]})}function J(){const t=C(),{fetch:r}=E();return k({mutationKey:[S.DELETE_BOARD],mutationFn:s=>r({endpoint:`/board/${s.id}`,method:"DELETE"}),onSettled:(s,n,{id:o})=>{t.invalidateQueries({queryKey:[f.GET_ALL_BOARDS]}),t.invalidateQueries({queryKey:[f.GET_BOARD_BY_ID,o]})}})}function W(){const t=C(),{fetch:r}=E();return k({mutationKey:[S.POST_CREATE_BOARD],mutationFn:s=>r({endpoint:"/board",method:"POST",body:s}),onSettled:()=>{t.invalidateQueries({queryKey:[f.GET_ALL_BOARDS]})}})}const L=a.createContext(null);function X(){const[t,r]=a.useState(null),[s,n]=a.useState({type:"browse"});return a.useMemo(()=>({id:t,mode:s,setMode:n,setId:r}),[t,s])}function c(){return a.useContext(L)}function Z({children:t}){return e.jsx(L.Provider,{value:X(),children:t})}function ee(){const t=Q(),{setMode:r}=c(),s=a.useCallback(()=>{r({type:"create"})},[r]);return a.useMemo(()=>t.isLoading?{status:"loading"}:t.isSuccess?{status:"success",data:te({res:t.data}),onCreateBoard:s}:{status:"error",retry:{isPending:t.isPending,onClick:t.refetch}},[t.data,t.isLoading,t.isPending,t.isSuccess,t.refetch,s])}function te(t){return t.res.boards.map(r=>({id:r.id,name:r.name}))}function re(){return e.jsxs(g,{direction:"column",gap:"sm",children:[e.jsx(B,{height:36}),e.jsx(B,{height:128})]})}function se(){return e.jsx(B,{h:256})}function ne({board:t,updateBoardContent:r,onClickDelete:s,onClickEditName:n}){const{editor:o}=N({defaultContent:t.content,onUpdate:({editor:d})=>{r(d.getHTML())}});return e.jsxs(e.Fragment,{children:[e.jsx(K,{mb:"md"}),e.jsx(q,{editor:o}),e.jsx(m,{h:"xs"}),e.jsx(g,{gap:"sm",justify:"space-between",children:e.jsxs(g,{gap:"sm",children:[e.jsx("button",{onClick:s,style:{all:"unset",cursor:"pointer"},children:e.jsx(h,{size:"sm",c:"violet",td:"underline",children:"Delete"})}),e.jsx("button",{onClick:n,style:{all:"unset",cursor:"pointer"},children:e.jsx(h,{size:"sm",c:"violet",td:"underline",children:"Edit Name"})})]})})]})}const oe=500;function ae({id:t}){const{setMode:r}=c(),s=P({req:{id:t}}),n=D(),o=z(l=>{n.mutate({id:t,content:l},{onError:()=>{u.show({color:"red",title:"Failed",message:"Unable to save board content. Some changes may not have been saved. Please try again shortly."})}})},oe),d=a.useCallback(()=>{r({type:"delete"})},[r]),i=a.useCallback(()=>{r({type:"edit"})},[r]);return a.useMemo(()=>s.isLoading?{status:"loading"}:s.isSuccess?{status:"success",data:ie({res:s.data}),updateBoardContent:o,onClickDelete:d,onClickEditName:i}:{status:"error",retry:{isPending:s.isPending,onClick:s.refetch}},[s.data,s.isLoading,s.isPending,s.isSuccess,s.refetch,o,d,i])}function ie(t){return{id:t.res.id,name:t.res.name,content:t.res.content}}function de({id:t}){const{status:r,data:s,retry:n,updateBoardContent:o,onClickDelete:d,onClickEditName:i}=ae({id:t});return r==="error"?e.jsx(p,{title:"Couldn't fetch board.",retry:n}):r==="success"?e.jsx(ne,{board:s,updateBoardContent:o,onClickDelete:d,onClickEditName:i}):e.jsx(se,{})}function ce({boards:t}){const{id:r,setId:s}=c();return e.jsxs(e.Fragment,{children:[e.jsx(G,{size:"sm",placeholder:"Board",data:t.map(n=>({value:n.id,label:n.name})),value:r,onChange:n=>{s(n)},nothingFoundMessage:"Nothing found...",searchable:!0,clearable:!0}),e.jsx(m,{h:"lg"}),r?e.jsx("div",{children:e.jsx(de,{id:r})},r):e.jsx(U,{title:"Nothing Selected",description:"Please select a Board"})]})}function ue({onClose:t}){const{setId:r}=c(),s=M({defaultValues:{name:""}}),n=W(),o=a.useCallback(d=>{n.mutate(d,{onSuccess:i=>{t(),r(i.id),u.show({color:"green",title:"Created",message:"Board created successfully"})},onError:i=>{if(!b(i)){s.setError("root",{message:"Something went wrong!"});return}A({axiosError:i,setError:s.setError})}})},[n,s,t,r]);return a.useMemo(()=>({form:s,onSubmit:o,isPending:n.isPending}),[n.isPending,s,o])}function le({onClose:t}){const{form:r,isPending:s,onSubmit:n}=ue({onClose:t});return e.jsx(v,{action:"Create",form:r,isPending:s,onSubmit:n})}function me({id:t,onClose:r}){const{setId:s}=c(),n=J(),o=a.useCallback(()=>{n.mutate({id:t},{onSuccess:()=>{s(null),u.show({color:"green",title:"Deleted",message:"Board deleted successfully"})},onError:()=>{u.show({color:"red",title:"Failed",message:"Couldn't delete board. Please try again shortly."})},onSettled:()=>{r()}})},[n,t,r,s]);return a.useMemo(()=>({isPending:n.isPending,onDelete:o}),[n.isPending,o])}function ge({id:t,onClose:r}){const{onDelete:s,isPending:n}=me({id:t,onClose:r});return e.jsx(I,{isCancelationPrimary:!0,isPending:n,mainLabel:"Delete",onCancel:r,onClickMain:s,verb:"delete this board"})}function he({id:t}){const r=P({req:{id:t}});return a.useMemo(()=>r.isLoading?{status:"loading"}:r.isSuccess?{status:"success",data:xe(r.data)}:{status:"error",retry:{onClick:r.refetch,isPending:r.isPending}},[r.data,r.isLoading,r.isPending,r.isSuccess,r.refetch])}function xe(t){return{id:t.id,content:t.content,name:t.name}}function fe({board:t,onClose:r}){const s=M({defaultValues:{name:t.name}}),n=D(),o=a.useCallback(d=>{n.mutate({id:t.id,name:d.name},{onSuccess:()=>{r(),u.show({color:"green",title:"Updated",message:"Board name updated successfully"})},onError:i=>{if(!b(i)){s.setError("root",{message:"Something went wrong!"});return}A({axiosError:i,setError:s.setError})}})},[t.id,s,r,n]);return a.useMemo(()=>({form:s,isPending:n.isPending,onSubmit:o}),[s,n.isPending,o])}function Be({board:t,onClose:r}){const{form:s,isPending:n,onSubmit:o}=fe({board:t,onClose:r});return e.jsx(v,{action:"Update",form:s,isPending:n,onSubmit:o})}function pe({id:t,onClose:r}){const{status:s,data:n,retry:o}=he({id:t});return s==="error"?e.jsx(p,{title:"Couldn't fetch board.",retry:o}):s==="success"?e.jsx(Be,{board:n,onClose:r}):e.jsx(R,{})}function je(){const{mode:t,setMode:r,id:s}=c(),n=a.useCallback(()=>{r({type:"browse"})},[r]);return e.jsxs(e.Fragment,{children:[e.jsx(x,{centered:!0,opened:t.type==="create",onClose:n,title:"Create Board",children:e.jsx(le,{onClose:n})}),e.jsx(x,{centered:!0,opened:t.type==="delete",onClose:n,title:"Delete Board",children:s&&e.jsx(ge,{onClose:n,id:s})}),e.jsx(x,{centered:!0,opened:t.type==="edit",onClose:n,title:"Edit Board",children:s&&e.jsx(pe,{onClose:n,id:s})})]})}function ye(){const{status:t,data:r,retry:s,onCreateBoard:n}=ee();return e.jsxs(e.Fragment,{children:[e.jsxs(g,{py:"md",align:"start",justify:"space-between",direction:{base:"column",sm:"row"},gap:"lg",children:[e.jsxs(j,{children:[e.jsx(w,{size:"h2",order:4,children:"Boards"}),e.jsx(h,{size:"sm",c:"gray",fw:500,children:"Jot down quick notes, ideas, and running lists"})]}),t==="success"&&e.jsx(y,{leftSection:e.jsx(O,{style:{width:"1.1rem",height:"1.1rem"}}),onClick:n,children:"Create Board"})]}),e.jsx(j,{p:"md",withBorder:!0,children:t==="loading"?e.jsx(re,{}):t==="error"?e.jsx(p,{title:"Couldn't fetch boards.",retry:s}):e.jsx(ce,{boards:r})}),t==="success"&&e.jsx(e.Fragment,{children:e.jsx(je,{})})]})}function Ce(){return e.jsx(Z,{children:e.jsx(ye,{})})}function Re(){return e.jsxs(e.Fragment,{children:[e.jsxs(Y,{children:[e.jsx(H,{component:F,to:T({type:_.DASHBOARD}),children:"Dashboard"}),e.jsx(h,{c:"violet",children:"Boards"})]}),e.jsx(Ce,{})]})}export{Re as default};
