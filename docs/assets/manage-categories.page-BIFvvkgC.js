import{v as p,V as h,M as j,Q as u,x as R,r as a,j as e,z as E,W as P,S as y,C as _,N as D,y as m,F as M,P as b,A as I,D as z,E as B,G as O}from"./index-QeqcR6KA.js";import{u as Q,T as c,a as q,b as K,P as Y}from"./use-get-all-categories-B4NvKFY-.js";import{E as N,a as S}from"./empty-query-d0UmKYox.js";import{P as U,C as V,M as W,a as x}from"./modal-loader-BLmLKq92.js";import{B as $}from"./Badge-D9ceBlw2.js";import{A,T as H}from"./TextInput-XsQGnRYI.js";import{Q as v}from"./query-error-B-wMY_Ln.js";import{a as T,A as J,b as X,c as Z}from"./types-B57ll-jg.js";import{z as C}from"./external-DQDL6DX6.js";import{h as F,A as ee}from"./handle-api-errors-BIJ2U5fQ.js";import{S as f}from"./Skeleton-CkgvsusR.js";import{B as te}from"./Breadcrumbs-CZ35VFgw.js";function se(){const s=p(),{fetch:t}=h();return T({mutationKey:[j.DELETE_DELETE_CATEGORY],mutationFn:r=>t({endpoint:`/category/${r.id}`,method:"DELETE",body:r}),onSettled:(r,n,{id:o})=>{s.invalidateQueries({queryKey:[u.GET_ALL_CATEGORIES]}),s.invalidateQueries({queryKey:[u.GET_CATEGORY_BY_ID,o]})}})}function re({id:s}){const{fetch:t}=h();return R({queryKey:[u.GET_CATEGORY_BY_ID,s],queryFn:()=>t({endpoint:`/category/${s}`,method:"GET"})})}function ne(){const s=p(),{fetch:t}=h();return T({mutationKey:[j.POST_CREATE_CATEGORY],mutationFn:r=>t({endpoint:"/category",method:"POST",body:r}),onSettled:()=>s.invalidateQueries({queryKey:[u.GET_ALL_CATEGORIES]})})}function oe(){const s=p(),{fetch:t}=h();return T({mutationKey:[j.PUT_UPDATE_CATEGORY],mutationFn:r=>t({endpoint:`/category/${r.id}`,method:"PUT",body:r}),onSettled:(r,n,{id:o})=>{s.invalidateQueries({queryKey:[u.GET_ALL_CATEGORIES]}),s.invalidateQueries({queryKey:[u.GET_CATEGORY_BY_ID,o]})}})}const w=a.createContext(null);function ie(){const[s,t]=a.useState({type:"browse"});return a.useMemo(()=>({mode:s,setMode:t}),[s])}function G(){return a.useContext(w)}function ae({children:s}){return e.jsx(w.Provider,{value:ie(),children:s})}function ce(){const{setMode:s}=G(),t=Q(),r=a.useCallback(()=>{s({type:"create"})},[s]),n=a.useCallback(i=>{s({type:"delete",id:i})},[s]),o=a.useCallback(i=>{s({type:"edit",id:i})},[s]);return a.useMemo(()=>t.isLoading?{status:"loading"}:t.isSuccess?{status:"success",tableEntries:t.data.map(le),onCreate:r,onDelete:n,onEdit:o}:{status:"error",retry:t.refetch,isPending:t.isFetching},[t.data,t.isLoading,t.isFetching,t.isSuccess,t.refetch,r,n,o])}function le(s){return{id:s.id,name:s.name,description:s.description}}function de({tableEntries:s,onDelete:t,onEdit:r}){return s.length===0?e.jsx(N,{title:"No Categories Yet"}):e.jsxs(c,{children:[e.jsx(c.Thead,{children:e.jsxs(c.Tr,{children:[e.jsx(c.Th,{style:{minWidth:"30%"},children:"Name"}),e.jsx(c.Th,{visibleFrom:"xs",children:"Description"}),e.jsx(c.Th,{style:{minWidth:"20%",textAlign:"end"},children:"Actions"})]})}),e.jsx(c.Tbody,{children:s.map(n=>e.jsxs(c.Tr,{children:[e.jsx(c.Td,{children:e.jsx($,{children:n.name})}),e.jsx(c.Td,{visibleFrom:"xs",children:n.description?n.description:e.jsx(E,{c:"gray",size:"sm",children:"-"})}),e.jsx(c.Td,{children:e.jsx(ue,{onDelete:()=>{t(n.id)},onEdit:()=>{r(n.id)}})})]},n.id))})]})}function ue({onDelete:s,onEdit:t}){return e.jsxs(P,{gap:"xs",justify:"end",children:[e.jsx(S,{label:"Edit Category",children:e.jsx(A,{size:"sm",variant:"light",onClick:t,children:e.jsx(U,{style:{width:"80%",height:"80%"}})})}),e.jsx(S,{label:"Delete Category",children:e.jsx(A,{size:"sm",variant:"light",onClick:s,children:e.jsx(q,{style:{width:"80%",height:"80%"}})})})]})}function ge({isPending:s,retry:t}){return e.jsx(v,{title:"Couldn't fetch categories.",retry:{onClick:t,isPending:s}})}function k({action:s,form:t,isPending:r,onSubmit:n}){var l,d,g;const o=t.formState.errors,i=(l=o.root)==null?void 0:l.message;return e.jsxs("form",{onSubmit:t.handleSubmit(n),children:[e.jsx(H,{size:"sm",label:"Name",placeholder:"Name",...t.register("name"),error:(d=o.name)==null?void 0:d.message}),e.jsx(y,{h:"sm"}),e.jsx(K,{size:"sm",label:"Description",placeholder:"Description",...t.register("description"),error:(g=o.description)==null?void 0:g.message,autosize:!0,minRows:2,maxRows:5}),i&&e.jsxs(e.Fragment,{children:[e.jsx(y,{h:"xl"}),e.jsx(J,{color:"pink",title:i})]}),e.jsx(y,{h:"xl"}),e.jsxs(_,{type:"submit",w:"100%",loading:r,children:[s," Category"]})]})}const me=C.object({name:C.string().min(1).max(24),description:C.string().max(255).nullable()});function L({defaultValues:s}){return X({defaultValues:s,resolver:Z(me)})}function he({onClose:s}){const t=L({defaultValues:{name:"",description:""}}),{mutate:r,isPending:n}=ne(),o=a.useCallback(i=>{r({name:i.name,description:i.description===""?null:i.description},{onSuccess:()=>{s(),m.show({color:"green",title:"Created",message:"Category created successfully"})},onError:l=>{if(!D(l)){t.setError("root",{message:"Something went wrong!"});return}F({axiosError:l,setError:t.setError})}})},[t,s,r]);return a.useMemo(()=>({form:t,isPending:n,onSubmit:o}),[t,n,o])}function ye({onClose:s}){const{form:t,isPending:r,onSubmit:n}=he({onClose:s});return e.jsx(k,{action:"Create",form:t,isPending:r,onSubmit:n})}function xe({id:s,onClose:t}){const r=se(),n=a.useCallback(()=>{t()},[t]),o=a.useCallback(()=>{r.mutate({id:s},{onSuccess:()=>{m.show({color:"green",title:"Deleted",message:"Category deleted successfully"})},onError:()=>{m.show({color:"red",title:"Failed",message:"Couldn't delete category. Please try again shortly."})},onSettled:()=>{t()}})},[r,s,t]);return a.useMemo(()=>({isPending:r.isPending,onCancel:n,onDelete:o}),[r.isPending,n,o])}function Ce({id:s,onClose:t}){const{isPending:r,onCancel:n,onDelete:o}=xe({id:s,onClose:t});return e.jsx(V,{isCancelationPrimary:!0,isPending:r,mainLabel:"Delete",onCancel:n,onClickMain:o,verb:"delete this category"})}function fe({id:s,defaultValues:t,onClose:r}){const n=L({defaultValues:t}),{mutate:o,isPending:i}=oe(),l=a.useCallback(d=>{o({id:s,name:d.name,description:d.description===""?null:d.description},{onSuccess:()=>{r(),m.show({color:"green",title:"Edited",message:"Category edited successfully"})},onError:g=>{if(!D(g)){n.setError("root",{message:"Something went wrong!"});return}F({axiosError:g,setError:n.setError})}})},[s,n,r,o]);return a.useMemo(()=>({form:n,isPending:i,onSubmit:l}),[n,i,l])}function pe({id:s}){const t=re({id:s});return a.useMemo(()=>t.isLoading?{status:"loading"}:t.isSuccess?{status:"success",category:t.data}:{status:"error",retry:t.refetch,isFetching:t.isFetching},[t.data,t.isFetching,t.isLoading,t.isSuccess,t.refetch])}function je({onClose:s,category:t}){const{form:r,isPending:n,onSubmit:o}=fe({id:t.id,defaultValues:{name:t.name,description:t.description},onClose:s});return e.jsx(k,{action:"Edit",form:r,isPending:n,onSubmit:o})}function Ee({id:s,onClose:t}){const{category:r,status:n,retry:o,isFetching:i}=pe({id:s});return n==="error"?e.jsx(v,{title:"Couldn't fetch category.",retry:{onClick:()=>void o(),isPending:i}}):n==="success"?e.jsx(je,{category:r,onClose:t}):e.jsx(W,{})}function Te(){const{mode:s,setMode:t}=G(),r=a.useCallback(()=>{t({type:"browse"})},[t]);return e.jsxs(e.Fragment,{children:[e.jsx(x,{centered:!0,opened:s.type==="create",onClose:r,title:"Create Category",children:s.type==="create"&&e.jsx(ye,{onClose:r})}),e.jsx(x,{centered:!0,opened:s.type==="delete",onClose:r,title:"Delete Category",children:s.type==="delete"&&e.jsx(Ce,{id:s.id,onClose:r})}),e.jsx(x,{centered:!0,opened:s.type==="edit",onClose:r,title:"Edit Category",children:s.type==="edit"&&e.jsx(Ee,{id:s.id,onClose:r})})]})}function be(){const s=new Array(8).fill(null);return e.jsx(M,{direction:"column",gap:"xs",children:s.map((t,r)=>e.jsxs(P,{children:[e.jsx(f,{flex:1,height:20}),e.jsx(f,{flex:6,height:20}),e.jsx(f,{flex:2,height:20})]},r))})}function Se(){const{isPending:s,onCreate:t,onDelete:r,onEdit:n,status:o,tableEntries:i,retry:l}=ce();return e.jsxs(e.Fragment,{children:[e.jsxs(M,{py:"md",align:"start",justify:"space-between",direction:{base:"column",sm:"row"},gap:"sm",children:[e.jsxs(b,{children:[e.jsx(I,{size:"h2",order:4,children:"Categories"}),e.jsx(E,{size:"sm",c:"gray",fw:500,children:"Used for organizing resources or tasks."})]}),o==="success"&&e.jsx(_,{leftSection:e.jsx(Y,{style:{width:"1.3rem",height:"1.3rem"}}),size:"sm",onClick:t,children:"Add Category"})]}),e.jsx(b,{p:"md",withBorder:!0,flex:1,children:o==="loading"?e.jsx(be,{}):o==="error"?e.jsx(ge,{retry:()=>void l(),isPending:s}):e.jsx(de,{tableEntries:i,onDelete:r,onEdit:n})}),o==="success"&&e.jsx(Te,{})]})}function Ae(){return e.jsx(ae,{children:e.jsx(Se,{})})}function ze(){return e.jsxs(e.Fragment,{children:[e.jsxs(te,{children:[e.jsx(ee,{component:B,to:z({type:O.DASHBOARD}),children:"Dashboard"}),e.jsx(E,{c:"violet",children:"Categories"})]}),e.jsx(Ae,{})]})}export{ze as default};
