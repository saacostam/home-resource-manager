import{v as b,w as f,M as C,Q as m,x as G,r as a,j as s,z as j,W as M,S as x,C as A,V as w,y as p,F as I,P as _,A as O,D as K,E as V,G as W}from"./index-BLz13xv5.js";import{T as c,a as Y,b as $,u as L,P as H}from"./use-get-all-categories-D0wup-dh.js";import{Q as T}from"./query-error-BskeKboM.js";import{u as J,N as X}from"./use-get-all-resources-DHdr48rL.js";import{E as Z,a as q}from"./empty-query-CilrBLKS.js";import{P as ee,M as k,C as se,a as E}from"./modal-loader-JxuN00To.js";import{B as te}from"./Badge-BGDDzTMw.js";import{A as D,T as re}from"./TextInput-C8z4uzlN.js";import{a as S,A as ne,b as ie,c as oe}from"./types-BopNODZg.js";import{z as y}from"./external-D-b8KTXK.js";import{S as ae}from"./Select-BnJLIbna.js";import{h as z,A as ce}from"./handle-api-errors-BcYMmNuI.js";import{S as R}from"./Skeleton-CrYbarqC.js";import{B as ue}from"./Breadcrumbs-ThxwYwsV.js";import"./clamp-DTmYCdls.js";function le(){const e=b(),{fetch:t}=f();return S({mutationKey:[C.DELETE_DELETE_RESOURCE],mutationFn:r=>t({endpoint:`/resource/${r.id}`,method:"DELETE"}),onSettled:(r,n,{id:i})=>{e.invalidateQueries({queryKey:[m.GET_ALL_RESOURCES]}),e.invalidateQueries({queryKey:[m.GET_RESOURCE_BY_ID,i]})}})}function de({id:e}){const{fetch:t}=f();return G({queryKey:[m.GET_RESOURCE_BY_ID,e],queryFn:()=>t({endpoint:`/resource/${e}`,method:"GET"})})}function me(){const e=b(),{fetch:t}=f();return S({mutationKey:[C.POST_CREATE_RESOURCE],mutationFn:r=>t({endpoint:"/resource",method:"POST",body:r}),onSettled:()=>e.invalidateQueries({queryKey:[m.GET_ALL_RESOURCES]})})}function he(){const e=b(),{fetch:t}=f();return S({mutationKey:[C.PUT_UPDATE_RESOURCE],mutationFn:r=>t({endpoint:`/resource/${r.id}`,method:"PUT",body:r}),onSettled:(r,n,{id:i})=>{e.invalidateQueries({queryKey:[m.GET_ALL_RESOURCES]}),e.invalidateQueries({queryKey:[m.GET_RESOURCE_BY_ID,i]})}})}const N=a.createContext(null);function ge(){const[e,t]=a.useState({type:"browse"});return a.useMemo(()=>({mode:e,setMode:t}),[e])}function Q(){return a.useContext(N)}function xe({children:e}){return s.jsx(N.Provider,{value:ge(),children:e})}function ye(){const{setMode:e}=Q(),t=J(),r=a.useCallback(()=>{e({type:"create"})},[e]),n=a.useCallback(o=>{e({type:"delete",id:o})},[e]),i=a.useCallback(o=>{e({type:"edit",id:o})},[e]);return a.useMemo(()=>t.isLoading?{status:"loading"}:t.isSuccess?{status:"success",tableEntries:t.data.map(je),onCreate:r,onDelete:n,onEdit:i}:{status:"error",retry:t.refetch,isFetching:t.isFetching},[t.data,t.isLoading,t.isFetching,t.isSuccess,t.refetch,r,n,i])}function je(e){var t;return{id:e.id,name:e.name,description:e.description??void 0,quantity:e.quantity,categoryName:((t=e.category)==null?void 0:t.name)??null}}function pe({tableEntries:e,onDelete:t,onEdit:r}){return e.length===0?s.jsx(Z,{title:"No Resources Yet"}):s.jsxs(c,{children:[s.jsx(c.Thead,{children:s.jsxs(c.Tr,{children:[s.jsx(c.Th,{style:{minWidth:"20%"},children:"Name"}),s.jsx(c.Th,{style:{minWidth:"15%"},children:"Category"}),s.jsx(c.Th,{visibleFrom:"xs",children:"Description"}),s.jsx(c.Th,{style:{minWidth:"15%",textAlign:"center"},visibleFrom:"xs",children:"Quantity"}),s.jsx(c.Th,{style:{minWidth:"20%",textAlign:"end"},children:"Actions"})]})}),s.jsx(c.Tbody,{children:e.map(n=>s.jsxs(c.Tr,{children:[s.jsx(c.Td,{children:n.name}),s.jsx(c.Td,{children:n.categoryName!==null?s.jsx(te,{size:"sm",children:n.categoryName}):s.jsx(j,{c:"gray",size:"sm",children:"-"})}),s.jsx(c.Td,{visibleFrom:"xs",children:n.description?n.description:s.jsx(j,{c:"gray",size:"sm",children:"-"})}),s.jsx(c.Td,{style:{textAlign:"center"},visibleFrom:"xs",children:n.quantity}),s.jsx(c.Td,{children:s.jsx(fe,{onDelete:()=>{t(n.id)},onEdit:()=>{r(n.id)}})})]},n.id))})]})}function fe({onDelete:e,onEdit:t}){return s.jsxs(M,{gap:"xs",justify:"end",children:[s.jsx(q,{label:"Edit Resource",children:s.jsx(D,{size:"sm",variant:"light",onClick:t,children:s.jsx(ee,{style:{width:"80%",height:"80%"}})})}),s.jsx(q,{label:"Delete Resource",children:s.jsx(D,{size:"sm",variant:"light",onClick:e,children:s.jsx(Y,{style:{width:"80%",height:"80%"}})})})]})}function U({action:e,categories:t,form:r,isPending:n,onSubmit:i}){var h,l,g,v,P;const o=r.formState.errors,u=(h=o.root)==null?void 0:h.message;return s.jsxs("form",{onSubmit:r.handleSubmit(i),children:[s.jsx(re,{size:"sm",label:"Name",placeholder:"Name",...r.register("name"),error:(l=o.name)==null?void 0:l.message}),s.jsx(x,{h:"sm"}),s.jsx($,{size:"sm",label:"Description",placeholder:"Description",...r.register("description"),error:(g=o.description)==null?void 0:g.message,autosize:!0,minRows:2,maxRows:5}),s.jsx(x,{h:"sm"}),s.jsx(X,{size:"sm",label:"Quantity",placeholder:"Quantity",...r.register("quantity"),value:r.watch("quantity"),onChange:d=>{const F=Number(d);r.setValue("quantity",Number.isNaN(F)?0:F)},min:0,max:void 0,error:(v=o.quantity)==null?void 0:v.message}),s.jsx(x,{h:"sm"}),s.jsx(ae,{size:"sm",label:"Category",placeholder:"Category",data:t.map(d=>({value:d.id,label:d.name})),...r.register("categoryId"),value:r.watch("categoryId"),onChange:d=>{r.setValue("categoryId",d)},error:(P=o.categoryId)==null?void 0:P.message,nothingFoundMessage:"Nothing found..."}),u&&s.jsxs(s.Fragment,{children:[s.jsx(x,{h:"xl"}),s.jsx(ne,{color:"pink",title:u})]}),s.jsx(x,{h:"xl"}),s.jsxs(A,{type:"submit",w:"100%",loading:n,children:[e," Resource"]})]})}const Ee=y.object({name:y.string().nonempty("Name is required").max(24),description:y.string().max(255).nullable(),quantity:y.coerce.number().nonnegative(),categoryId:y.string().nullable()});function B({defaultValues:e}){return ie({defaultValues:e,resolver:oe(Ee)})}function Re({onClose:e}){const t=B({defaultValues:{name:"",description:"",quantity:0,categoryId:""}}),{mutate:r,isPending:n}=me(),i=a.useCallback(o=>{r({name:o.name,description:o.description===""?null:o.description,quantity:o.quantity,categoryId:o.categoryId},{onSuccess:()=>{e(),p.show({color:"green",title:"Created",message:"Category created successfully"})},onError:u=>{if(!w(u)){t.setError("root",{message:"Something went wrong!"});return}z({axiosError:u,setError:t.setError})}})},[t,e,r]);return a.useMemo(()=>({form:t,isPending:n,onSubmit:i}),[t,n,i])}function be(){const e=L();return a.useMemo(()=>e.isLoading?{status:"loading"}:e.isSuccess?{status:"success",categories:e.data}:{status:"error",retry:{onClick:e.refetch,isPending:e.isFetching}},[e.data,e.isLoading,e.isFetching,e.isSuccess,e.refetch])}function Ce({categories:e,onClose:t}){const{form:r,isPending:n,onSubmit:i}=Re({onClose:t});return s.jsx(U,{action:"Create",categories:e,form:r,isPending:n,onSubmit:i})}function Te({onClose:e}){const{categories:t,status:r,retry:n}=be();return r==="error"?s.jsx(T,{title:"Couldn't fetch your categories.",retry:n}):r==="success"?s.jsx(Ce,{categories:t,onClose:e}):s.jsx(k,{})}function Se({id:e,onClose:t}){const r=le(),n=a.useCallback(()=>{t()},[t]),i=a.useCallback(()=>{r.mutate({id:e},{onSuccess:()=>{p.show({color:"green",title:"Deleted",message:"Resource deleted successfully"})},onError:()=>{p.show({color:"red",title:"Failed",message:"Couldn't delete resource. Please try again shortly."})},onSettled:()=>{t()}})},[r,e,t]);return a.useMemo(()=>({isPending:r.isPending,onCancel:n,onDelete:i}),[r.isPending,n,i])}function ve({id:e,onClose:t}){const{isPending:r,onCancel:n,onDelete:i}=Se({id:e,onClose:t});return s.jsx(se,{isCancelationPrimary:!0,isPending:r,mainLabel:"Delete",onCancel:n,onClickMain:i,verb:"delete this resource"})}function Pe({id:e,categories:t,onClose:r,resource:n}){const i=B({defaultValues:{name:n.name,description:n.description,quantity:n.quantity,categoryId:t.find(l=>l.id===n.categoryId)?n.categoryId:""}}),{mutate:o,isPending:u}=he(),h=a.useCallback(l=>{o({id:e,name:l.name,description:l.description===""?null:l.description,quantity:l.quantity,categoryId:l.categoryId},{onSuccess:()=>{r(),p.show({color:"green",title:"Edited",message:"Resource edited successfully"})},onError:g=>{if(!w(g)){i.setError("root",{message:"Something went wrong!"});return}z({axiosError:g,setError:i.setError})}})},[e,i,r,o]);return a.useMemo(()=>({form:i,isPending:u,onSubmit:h}),[i,u,h])}function Fe({id:e}){const t=de({id:e}),r=L();return a.useMemo(()=>t.isLoading||r.isLoading?{status:"loading"}:t.isSuccess&&r.isSuccess?{status:"success",resource:t.data,categories:r.data}:{status:"error",retry:()=>{r.refetch(),t.refetch()},isFetching:t.isFetching||r.isFetching},[r,t])}function _e({id:e,categories:t,resource:r,onClose:n}){const{form:i,isPending:o,onSubmit:u}=Pe({id:e,categories:t,onClose:n,resource:r});return s.jsx(U,{action:"Edit",categories:t,form:i,isPending:o,onSubmit:u})}function qe({id:e,onClose:t}){const{categories:r,isFetching:n,status:i,resource:o,retry:u}=Fe({id:e});return i==="error"?s.jsx(T,{title:"Couldn't fetch resource and the necessary categories.",retry:{onClick:u,isPending:n}}):i==="success"?s.jsx(_e,{id:e,categories:r,resource:o,onClose:t}):s.jsx(k,{})}function De(){const{mode:e,setMode:t}=Q(),r=a.useCallback(()=>{t({type:"browse"})},[t]);return s.jsxs(s.Fragment,{children:[s.jsx(E,{centered:!0,opened:e.type==="create",onClose:r,title:"Create Resource",children:e.type==="create"&&s.jsx(Te,{onClose:r})}),s.jsx(E,{centered:!0,opened:e.type==="delete",onClose:r,title:"Delete Resource",children:e.type==="delete"&&s.jsx(ve,{id:e.id,onClose:r})}),s.jsx(E,{centered:!0,opened:e.type==="edit",onClose:r,title:"Edit Resource",children:e.type==="edit"&&s.jsx(qe,{id:e.id,onClose:r})})]})}function Me(){const e=new Array(8).fill(null);return s.jsx(I,{direction:"column",gap:"xs",children:e.map((t,r)=>s.jsxs(M,{children:[s.jsx(R,{flex:1,height:20}),s.jsx(R,{flex:6,height:20}),s.jsx(R,{flex:2,height:20})]},r))})}function Ae(){const{status:e,retry:t,isFetching:r,onCreate:n,onDelete:i,onEdit:o,tableEntries:u}=ye();return s.jsxs(s.Fragment,{children:[s.jsxs(I,{py:"md",align:"start",justify:"space-between",direction:{base:"column",sm:"row"},gap:"sm",children:[s.jsxs(_,{children:[s.jsx(O,{size:"h2",order:4,children:"Resources"}),s.jsx(j,{size:"sm",c:"gray",fw:500,children:"Used for tracking your house assets."})]}),e==="success"&&s.jsx(A,{leftSection:s.jsx(H,{style:{width:"1.3rem",height:"1.3rem"}}),size:"sm",onClick:n,children:"Add Resource"})]}),s.jsx(_,{p:"md",withBorder:!0,flex:1,children:e==="loading"?s.jsx(Me,{}):e==="error"?s.jsx(T,{title:"Couldn't fetch resources.",retry:{onClick:()=>void t(),isPending:r}}):s.jsx(pe,{tableEntries:u,onDelete:i,onEdit:o})}),e==="success"&&s.jsx(De,{})]})}function we(){return s.jsx(xe,{children:s.jsx(Ae,{})})}function He(){return s.jsxs(s.Fragment,{children:[s.jsxs(ue,{children:[s.jsx(ce,{component:V,to:K({type:W.DASHBOARD}),children:"Dashboard"}),s.jsx(j,{c:"violet",children:"Resources"})]}),s.jsx(we,{})]})}export{He as default};
