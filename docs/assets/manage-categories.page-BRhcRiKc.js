import{q as f,Y as h,t as j,M as p,Q as u,v as L,r as a,Z as A,j as e,y as E,_ as P,S as y,D as _,$ as D,W as M,X as v,w as m,F as w,P as T,A as R,E as I,G as q,H as B}from"./index-Dph-KdTA.js";import{u as O,T as c,a as Q,b as K,P as Y}from"./use-get-all-categories-Y6Ykp13U.js";import{E as z,T as b}from"./empty-query-nxbbEOvb.js";import{P as U,C as N,M as $,a as x}from"./modal-loader-Y6RIr5VN.js";import{B as W}from"./Badge-DS68auwQ.js";import{A as S,T as H}from"./TextInput-D4lYxEtG.js";import{Q as F}from"./query-error-CNsdQYee.js";import{A as V}from"./Alert-DxgmFpR2.js";import{S as C}from"./Skeleton-CJ5-Kzcs.js";import{B as X}from"./Breadcrumbs-BwGdq7gf.js";import{A as Z}from"./Anchor-C7SuYMB3.js";function J(){const s=f(),{fetch:t}=h();return j({mutationKey:[p.DELETE_DELETE_CATEGORY],mutationFn:r=>t({endpoint:`/category/${r.id}`,method:"DELETE",body:r}),onSettled:(r,n,{id:i})=>{s.invalidateQueries({queryKey:[u.GET_ALL_CATEGORIES]}),s.invalidateQueries({queryKey:[u.GET_CATEGORY_BY_ID,i]})}})}function ee({id:s}){const{fetch:t}=h();return L({queryKey:[u.GET_CATEGORY_BY_ID,s],queryFn:()=>t({endpoint:`/category/${s}`,method:"GET"})})}function te(){const s=f(),{fetch:t}=h();return j({mutationKey:[p.POST_CREATE_CATEGORY],mutationFn:r=>t({endpoint:"/category",method:"POST",body:r}),onSettled:()=>s.invalidateQueries({queryKey:[u.GET_ALL_CATEGORIES]})})}function se(){const s=f(),{fetch:t}=h();return j({mutationKey:[p.PUT_UPDATE_CATEGORY],mutationFn:r=>t({endpoint:`/category/${r.id}`,method:"PUT",body:r}),onSettled:(r,n,{id:i})=>{s.invalidateQueries({queryKey:[u.GET_ALL_CATEGORIES]}),s.invalidateQueries({queryKey:[u.GET_CATEGORY_BY_ID,i]})}})}function re(){const[s,t]=a.useState({type:"browse"});return a.useMemo(()=>({mode:s,setMode:t}),[s])}function G(){return a.useContext(A)}function ne({children:s}){return e.jsx(A.Provider,{value:re(),children:s})}function ie(){const{setMode:s}=G(),t=O(),r=a.useCallback(()=>{s({type:"create"})},[s]),n=a.useCallback(o=>{s({type:"delete",id:o})},[s]),i=a.useCallback(o=>{s({type:"edit",id:o})},[s]);return a.useMemo(()=>t.isLoading?{status:"loading"}:t.isSuccess?{status:"success",tableEntries:t.data.map(oe),onCreate:r,onDelete:n,onEdit:i}:{status:"error",retry:t.refetch,isPending:t.isFetching},[t.data,t.isLoading,t.isFetching,t.isSuccess,t.refetch,r,n,i])}function oe(s){return{id:s.id,name:s.name,description:s.description}}function ae({tableEntries:s,onDelete:t,onEdit:r}){return s.length===0?e.jsx(z,{title:"No Categories Yet"}):e.jsxs(c,{children:[e.jsx(c.Thead,{children:e.jsxs(c.Tr,{children:[e.jsx(c.Th,{style:{minWidth:"30%"},children:"Name"}),e.jsx(c.Th,{visibleFrom:"xs",children:"Description"}),e.jsx(c.Th,{style:{minWidth:"20%",textAlign:"end"},children:"Actions"})]})}),e.jsx(c.Tbody,{children:s.map(n=>e.jsxs(c.Tr,{children:[e.jsx(c.Td,{children:e.jsx(W,{children:n.name})}),e.jsx(c.Td,{visibleFrom:"xs",children:n.description?n.description:e.jsx(E,{c:"gray",size:"sm",children:"-"})}),e.jsx(c.Td,{children:e.jsx(ce,{onDelete:()=>{t(n.id)},onEdit:()=>{r(n.id)}})})]},n.id))})]})}function ce({onDelete:s,onEdit:t}){return e.jsxs(P,{gap:"xs",justify:"end",children:[e.jsx(b,{label:"Edit Category",children:e.jsx(S,{size:"sm",variant:"light",onClick:t,children:e.jsx(U,{style:{width:"80%",height:"80%"}})})}),e.jsx(b,{label:"Delete Category",children:e.jsx(S,{size:"sm",variant:"light",onClick:s,children:e.jsx(Q,{style:{width:"80%",height:"80%"}})})})]})}function le({isPending:s,retry:t}){return e.jsx(F,{title:"Couldn't fetch categories.",retry:{onClick:t,isPending:s}})}function k({action:s,form:t,isPending:r,onSubmit:n}){var l,d,g;const i=t.formState.errors,o=(l=i.root)==null?void 0:l.message;return e.jsxs("form",{onSubmit:t.handleSubmit(n),children:[e.jsx(H,{size:"sm",label:"Name",placeholder:"Name",...t.register("name"),error:(d=i.name)==null?void 0:d.message}),e.jsx(y,{h:"sm"}),e.jsx(K,{size:"sm",label:"Description",placeholder:"Description",...t.register("description"),error:(g=i.description)==null?void 0:g.message,autosize:!0,minRows:2,maxRows:5}),o&&e.jsxs(e.Fragment,{children:[e.jsx(y,{h:"xl"}),e.jsx(V,{color:"pink",title:o})]}),e.jsx(y,{h:"xl"}),e.jsxs(_,{type:"submit",w:"100%",loading:r,children:[s," Category"]})]})}function de({onClose:s}){const t=D({defaultValues:{name:"",description:""}}),{mutate:r,isPending:n}=te(),i=a.useCallback(o=>{r({name:o.name,description:o.description===""?null:o.description},{onSuccess:()=>{s(),m.show({color:"green",title:"Created",message:"Category created successfully"})},onError:l=>{if(!M(l)){t.setError("root",{message:"Something went wrong!"});return}v({axiosError:l,setError:t.setError})}})},[t,s,r]);return a.useMemo(()=>({form:t,isPending:n,onSubmit:i}),[t,n,i])}function ue({onClose:s}){const{form:t,isPending:r,onSubmit:n}=de({onClose:s});return e.jsx(k,{action:"Create",form:t,isPending:r,onSubmit:n})}function ge({id:s,onClose:t}){const r=J(),n=a.useCallback(()=>{t()},[t]),i=a.useCallback(()=>{r.mutate({id:s},{onSuccess:()=>{m.show({color:"green",title:"Deleted",message:"Category deleted successfully"})},onError:()=>{m.show({color:"red",title:"Failed",message:"Couldn't delete category. Please try again shortly."})},onSettled:()=>{t()}})},[r,s,t]);return a.useMemo(()=>({isPending:r.isPending,onCancel:n,onDelete:i}),[r.isPending,n,i])}function me({id:s,onClose:t}){const{isPending:r,onCancel:n,onDelete:i}=ge({id:s,onClose:t});return e.jsx(N,{isCancelationPrimary:!0,isPending:r,mainLabel:"Delete",onCancel:n,onClickMain:i,verb:"delete this category"})}function he({id:s,defaultValues:t,onClose:r}){const n=D({defaultValues:t}),{mutate:i,isPending:o}=se(),l=a.useCallback(d=>{i({id:s,name:d.name,description:d.description===""?null:d.description},{onSuccess:()=>{r(),m.show({color:"green",title:"Edited",message:"Category edited successfully"})},onError:g=>{if(!M(g)){n.setError("root",{message:"Something went wrong!"});return}v({axiosError:g,setError:n.setError})}})},[s,n,r,i]);return a.useMemo(()=>({form:n,isPending:o,onSubmit:l}),[n,o,l])}function ye({id:s}){const t=ee({id:s});return a.useMemo(()=>t.isLoading?{status:"loading"}:t.isSuccess?{status:"success",category:t.data}:{status:"error",retry:t.refetch,isFetching:t.isFetching},[t.data,t.isFetching,t.isLoading,t.isSuccess,t.refetch])}function xe({onClose:s,category:t}){const{form:r,isPending:n,onSubmit:i}=he({id:t.id,defaultValues:{name:t.name,description:t.description},onClose:s});return e.jsx(k,{action:"Edit",form:r,isPending:n,onSubmit:i})}function Ce({id:s,onClose:t}){const{category:r,status:n,retry:i,isFetching:o}=ye({id:s});return n==="error"?e.jsx(F,{title:"Couldn't fetch category.",retry:{onClick:()=>void i(),isPending:o}}):n==="success"?e.jsx(xe,{category:r,onClose:t}):e.jsx($,{})}function fe(){const{mode:s,setMode:t}=G(),r=a.useCallback(()=>{t({type:"browse"})},[t]);return e.jsxs(e.Fragment,{children:[e.jsx(x,{centered:!0,opened:s.type==="create",onClose:r,title:"Create Category",children:s.type==="create"&&e.jsx(ue,{onClose:r})}),e.jsx(x,{centered:!0,opened:s.type==="delete",onClose:r,title:"Delete Category",children:s.type==="delete"&&e.jsx(me,{id:s.id,onClose:r})}),e.jsx(x,{centered:!0,opened:s.type==="edit",onClose:r,title:"Edit Category",children:s.type==="edit"&&e.jsx(Ce,{id:s.id,onClose:r})})]})}function je(){const s=new Array(8).fill(null);return e.jsx(w,{direction:"column",gap:"xs",children:s.map((t,r)=>e.jsxs(P,{children:[e.jsx(C,{flex:1,height:20}),e.jsx(C,{flex:6,height:20}),e.jsx(C,{flex:2,height:20})]},r))})}function pe(){const{isPending:s,onCreate:t,onDelete:r,onEdit:n,status:i,tableEntries:o,retry:l}=ie();return e.jsxs(e.Fragment,{children:[e.jsxs(w,{py:"md",align:"start",justify:"space-between",direction:{base:"column",sm:"row"},gap:"sm",children:[e.jsxs(T,{children:[e.jsx(R,{size:"h2",order:4,children:"Categories"}),e.jsx(E,{size:"sm",c:"gray",fw:500,children:"Used for organizing resources or tasks."})]}),i==="success"&&e.jsx(_,{leftSection:e.jsx(Y,{style:{width:"1.3rem",height:"1.3rem"}}),size:"sm",onClick:t,children:"Add Category"})]}),e.jsx(T,{p:"md",withBorder:!0,flex:1,children:i==="loading"?e.jsx(je,{}):i==="error"?e.jsx(le,{retry:()=>void l(),isPending:s}):e.jsx(ae,{tableEntries:o,onDelete:r,onEdit:n})}),i==="success"&&e.jsx(fe,{})]})}function Ee(){return e.jsx(ne,{children:e.jsx(pe,{})})}function Ge(){return e.jsxs(e.Fragment,{children:[e.jsxs(X,{children:[e.jsx(Z,{component:q,to:I({type:B.DASHBOARD}),children:"Dashboard"}),e.jsx(E,{c:"violet",children:"Categories"})]}),e.jsx(Ee,{})]})}export{Ge as default};
