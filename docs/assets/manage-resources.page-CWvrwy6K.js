import{q as R,Y as f,t as C,M as b,Q as m,v as B,r as a,a0 as M,j as e,y,_ as q,S as x,D as A,a1 as w,W as I,X as L,w as j,F as k,P as _,A as G,E as O,G as K,H as W}from"./index-hN6QEj4m.js";import{T as c,a as Y,b as V,u as Q,P as $}from"./use-get-all-categories-BWqUkK7Z.js";import{Q as T}from"./query-error-zqwJl0FX.js";import{u as H,N as X}from"./use-get-all-resources-B0dGLiqy.js";import{E as J,T as F}from"./empty-query-CCE0tans.js";import{P as Z,M as N,C as ee,a as p}from"./modal-loader-D8fo-V8a.js";import{B as se}from"./Badge-BFKND05p.js";import{A as D,T as te}from"./TextInput-C4iTWAL6.js";import{S as re}from"./Select-eLjaeruw.js";import{A as ne}from"./Alert-DP2MxH_u.js";import{S as E}from"./Skeleton-L5MRzSN-.js";import{B as ie}from"./Breadcrumbs-CWjQaVpH.js";import{A as oe}from"./Anchor-ChJvCUgj.js";function ae(){const s=R(),{fetch:t}=f();return C({mutationKey:[b.DELETE_DELETE_RESOURCE],mutationFn:r=>t({endpoint:`/resource/${r.id}`,method:"DELETE"}),onSettled:(r,n,{id:i})=>{s.invalidateQueries({queryKey:[m.GET_ALL_RESOURCES]}),s.invalidateQueries({queryKey:[m.GET_RESOURCE_BY_ID,i]})}})}function ce({id:s}){const{fetch:t}=f();return B({queryKey:[m.GET_RESOURCE_BY_ID,s],queryFn:()=>t({endpoint:`/resource/${s}`,method:"GET"})})}function ue(){const s=R(),{fetch:t}=f();return C({mutationKey:[b.POST_CREATE_RESOURCE],mutationFn:r=>t({endpoint:"/resource",method:"POST",body:r}),onSettled:()=>s.invalidateQueries({queryKey:[m.GET_ALL_RESOURCES]})})}function le(){const s=R(),{fetch:t}=f();return C({mutationKey:[b.PUT_UPDATE_RESOURCE],mutationFn:r=>t({endpoint:`/resource/${r.id}`,method:"PUT",body:r}),onSettled:(r,n,{id:i})=>{s.invalidateQueries({queryKey:[m.GET_ALL_RESOURCES]}),s.invalidateQueries({queryKey:[m.GET_RESOURCE_BY_ID,i]})}})}function de(){const[s,t]=a.useState({type:"browse"});return a.useMemo(()=>({mode:s,setMode:t}),[s])}function U(){return a.useContext(M)}function me({children:s}){return e.jsx(M.Provider,{value:de(),children:s})}function he(){const{setMode:s}=U(),t=H(),r=a.useCallback(()=>{s({type:"create"})},[s]),n=a.useCallback(o=>{s({type:"delete",id:o})},[s]),i=a.useCallback(o=>{s({type:"edit",id:o})},[s]);return a.useMemo(()=>t.isLoading?{status:"loading"}:t.isSuccess?{status:"success",tableEntries:t.data.map(ge),onCreate:r,onDelete:n,onEdit:i}:{status:"error",retry:t.refetch,isFetching:t.isFetching},[t.data,t.isLoading,t.isFetching,t.isSuccess,t.refetch,r,n,i])}function ge(s){var t;return{id:s.id,name:s.name,description:s.description??void 0,quantity:s.quantity,categoryName:((t=s.category)==null?void 0:t.name)??null}}function xe({tableEntries:s,onDelete:t,onEdit:r}){return s.length===0?e.jsx(J,{title:"No Resources Yet"}):e.jsxs(c,{children:[e.jsx(c.Thead,{children:e.jsxs(c.Tr,{children:[e.jsx(c.Th,{style:{minWidth:"20%"},children:"Name"}),e.jsx(c.Th,{style:{minWidth:"15%"},children:"Category"}),e.jsx(c.Th,{visibleFrom:"xs",children:"Description"}),e.jsx(c.Th,{style:{minWidth:"15%",textAlign:"center"},visibleFrom:"xs",children:"Quantity"}),e.jsx(c.Th,{style:{minWidth:"20%",textAlign:"end"},children:"Actions"})]})}),e.jsx(c.Tbody,{children:s.map(n=>e.jsxs(c.Tr,{children:[e.jsx(c.Td,{children:n.name}),e.jsx(c.Td,{children:n.categoryName!==null?e.jsx(se,{size:"sm",children:n.categoryName}):e.jsx(y,{c:"gray",size:"sm",children:"-"})}),e.jsx(c.Td,{visibleFrom:"xs",children:n.description?n.description:e.jsx(y,{c:"gray",size:"sm",children:"-"})}),e.jsx(c.Td,{style:{textAlign:"center"},visibleFrom:"xs",children:n.quantity}),e.jsx(c.Td,{children:e.jsx(ye,{onDelete:()=>{t(n.id)},onEdit:()=>{r(n.id)}})})]},n.id))})]})}function ye({onDelete:s,onEdit:t}){return e.jsxs(q,{gap:"xs",justify:"end",children:[e.jsx(F,{label:"Edit Resource",children:e.jsx(D,{size:"sm",variant:"light",onClick:t,children:e.jsx(Z,{style:{width:"80%",height:"80%"}})})}),e.jsx(F,{label:"Delete Resource",children:e.jsx(D,{size:"sm",variant:"light",onClick:s,children:e.jsx(Y,{style:{width:"80%",height:"80%"}})})})]})}function z({action:s,categories:t,form:r,isPending:n,onSubmit:i}){var h,l,g,S,v;const o=r.formState.errors,u=(h=o.root)==null?void 0:h.message;return e.jsxs("form",{onSubmit:r.handleSubmit(i),children:[e.jsx(te,{size:"sm",label:"Name",placeholder:"Name",...r.register("name"),error:(l=o.name)==null?void 0:l.message}),e.jsx(x,{h:"sm"}),e.jsx(V,{size:"sm",label:"Description",placeholder:"Description",...r.register("description"),error:(g=o.description)==null?void 0:g.message,autosize:!0,minRows:2,maxRows:5}),e.jsx(x,{h:"sm"}),e.jsx(X,{size:"sm",label:"Quantity",placeholder:"Quantity",...r.register("quantity"),value:r.watch("quantity"),onChange:d=>{const P=Number(d);r.setValue("quantity",Number.isNaN(P)?0:P)},min:0,max:void 0,error:(S=o.quantity)==null?void 0:S.message}),e.jsx(x,{h:"sm"}),e.jsx(re,{size:"sm",label:"Category",placeholder:"Category",data:t.map(d=>({value:d.id,label:d.name})),...r.register("categoryId"),value:r.watch("categoryId"),onChange:d=>{r.setValue("categoryId",d)},error:(v=o.categoryId)==null?void 0:v.message,nothingFoundMessage:"Nothing found..."}),u&&e.jsxs(e.Fragment,{children:[e.jsx(x,{h:"xl"}),e.jsx(ne,{color:"pink",title:u})]}),e.jsx(x,{h:"xl"}),e.jsxs(A,{type:"submit",w:"100%",loading:n,children:[s," Resource"]})]})}function je({onClose:s}){const t=w({defaultValues:{name:"",description:"",quantity:0,categoryId:""}}),{mutate:r,isPending:n}=ue(),i=a.useCallback(o=>{r({name:o.name,description:o.description===""?null:o.description,quantity:o.quantity,categoryId:o.categoryId},{onSuccess:()=>{s(),j.show({color:"green",title:"Created",message:"Category created successfully"})},onError:u=>{if(!I(u)){t.setError("root",{message:"Something went wrong!"});return}L({axiosError:u,setError:t.setError})}})},[t,s,r]);return a.useMemo(()=>({form:t,isPending:n,onSubmit:i}),[t,n,i])}function fe(){const s=Q();return a.useMemo(()=>s.isLoading?{status:"loading"}:s.isSuccess?{status:"success",categories:s.data}:{status:"error",retry:{onClick:s.refetch,isPending:s.isFetching}},[s.data,s.isLoading,s.isFetching,s.isSuccess,s.refetch])}function pe({categories:s,onClose:t}){const{form:r,isPending:n,onSubmit:i}=je({onClose:t});return e.jsx(z,{action:"Create",categories:s,form:r,isPending:n,onSubmit:i})}function Ee({onClose:s}){const{categories:t,status:r,retry:n}=fe();return r==="error"?e.jsx(T,{title:"Couldn't fetch your categories.",retry:n}):r==="success"?e.jsx(pe,{categories:t,onClose:s}):e.jsx(N,{})}function Re({id:s,onClose:t}){const r=ae(),n=a.useCallback(()=>{t()},[t]),i=a.useCallback(()=>{r.mutate({id:s},{onSuccess:()=>{j.show({color:"green",title:"Deleted",message:"Resource deleted successfully"})},onError:()=>{j.show({color:"red",title:"Failed",message:"Couldn't delete resource. Please try again shortly."})},onSettled:()=>{t()}})},[r,s,t]);return a.useMemo(()=>({isPending:r.isPending,onCancel:n,onDelete:i}),[r.isPending,n,i])}function Ce({id:s,onClose:t}){const{isPending:r,onCancel:n,onDelete:i}=Re({id:s,onClose:t});return e.jsx(ee,{isCancelationPrimary:!0,isPending:r,mainLabel:"Delete",onCancel:n,onClickMain:i,verb:"delete this resource"})}function be({id:s,categories:t,onClose:r,resource:n}){const i=w({defaultValues:{name:n.name,description:n.description,quantity:n.quantity,categoryId:t.find(l=>l.id===n.categoryId)?n.categoryId:""}}),{mutate:o,isPending:u}=le(),h=a.useCallback(l=>{o({id:s,name:l.name,description:l.description===""?null:l.description,quantity:l.quantity,categoryId:l.categoryId},{onSuccess:()=>{r(),j.show({color:"green",title:"Edited",message:"Resource edited successfully"})},onError:g=>{if(!I(g)){i.setError("root",{message:"Something went wrong!"});return}L({axiosError:g,setError:i.setError})}})},[s,i,r,o]);return a.useMemo(()=>({form:i,isPending:u,onSubmit:h}),[i,u,h])}function Te({id:s}){const t=ce({id:s}),r=Q();return a.useMemo(()=>t.isLoading||r.isLoading?{status:"loading"}:t.isSuccess&&r.isSuccess?{status:"success",resource:t.data,categories:r.data}:{status:"error",retry:()=>{r.refetch(),t.refetch()},isFetching:t.isFetching||r.isFetching},[r,t])}function Se({id:s,categories:t,resource:r,onClose:n}){const{form:i,isPending:o,onSubmit:u}=be({id:s,categories:t,onClose:n,resource:r});return e.jsx(z,{action:"Edit",categories:t,form:i,isPending:o,onSubmit:u})}function ve({id:s,onClose:t}){const{categories:r,isFetching:n,status:i,resource:o,retry:u}=Te({id:s});return i==="error"?e.jsx(T,{title:"Couldn't fetch resource and the necessary categories.",retry:{onClick:u,isPending:n}}):i==="success"?e.jsx(Se,{id:s,categories:r,resource:o,onClose:t}):e.jsx(N,{})}function Pe(){const{mode:s,setMode:t}=U(),r=a.useCallback(()=>{t({type:"browse"})},[t]);return e.jsxs(e.Fragment,{children:[e.jsx(p,{centered:!0,opened:s.type==="create",onClose:r,title:"Create Resource",children:s.type==="create"&&e.jsx(Ee,{onClose:r})}),e.jsx(p,{centered:!0,opened:s.type==="delete",onClose:r,title:"Delete Resource",children:s.type==="delete"&&e.jsx(Ce,{id:s.id,onClose:r})}),e.jsx(p,{centered:!0,opened:s.type==="edit",onClose:r,title:"Edit Resource",children:s.type==="edit"&&e.jsx(ve,{id:s.id,onClose:r})})]})}function _e(){const s=new Array(8).fill(null);return e.jsx(k,{direction:"column",gap:"xs",children:s.map((t,r)=>e.jsxs(q,{children:[e.jsx(E,{flex:1,height:20}),e.jsx(E,{flex:6,height:20}),e.jsx(E,{flex:2,height:20})]},r))})}function Fe(){const{status:s,retry:t,isFetching:r,onCreate:n,onDelete:i,onEdit:o,tableEntries:u}=he();return e.jsxs(e.Fragment,{children:[e.jsxs(k,{py:"md",align:"start",justify:"space-between",direction:{base:"column",sm:"row"},gap:"sm",children:[e.jsxs(_,{children:[e.jsx(G,{size:"h2",order:4,children:"Resources"}),e.jsx(y,{size:"sm",c:"gray",fw:500,children:"Used for tracking your house assets."})]}),s==="success"&&e.jsx(A,{leftSection:e.jsx($,{style:{width:"1.3rem",height:"1.3rem"}}),size:"sm",onClick:n,children:"Add Resource"})]}),e.jsx(_,{p:"md",withBorder:!0,flex:1,children:s==="loading"?e.jsx(_e,{}):s==="error"?e.jsx(T,{title:"Couldn't fetch resources.",retry:{onClick:()=>void t(),isPending:r}}):e.jsx(xe,{tableEntries:u,onDelete:i,onEdit:o})}),s==="success"&&e.jsx(Pe,{})]})}function De(){return e.jsx(me,{children:e.jsx(Fe,{})})}function Oe(){return e.jsxs(e.Fragment,{children:[e.jsxs(ie,{children:[e.jsx(oe,{component:K,to:O({type:W.DASHBOARD}),children:"Dashboard"}),e.jsx(y,{c:"violet",children:"Resources"})]}),e.jsx(De,{})]})}export{Oe as default};
