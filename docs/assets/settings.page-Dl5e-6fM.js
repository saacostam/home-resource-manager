import{v as y,K as z,M as T,N as b,r as f,V as E,y as F,j as e,S as g,F as i,C as A,P as x,A as w,z as p,D as C,E as M,G as P}from"./index-Dc5gea9V.js";import{a as v,b as k,c as Q,A as R}from"./types-DM-qadrJ.js";import{z as h}from"./external-M-J_qBnQ.js";import{u as U,a as B}from"./use-query-all-timezones-DH4XztMF.js";import{Q as D}from"./query-error-DnVkmsEU.js";import{h as L,A as K}from"./handle-api-errors-C5ts5Tjv.js";import{S as V}from"./Select-C2YSWk7A.js";import{S as a}from"./Skeleton-D8hP01vJ.js";import{B as G}from"./Breadcrumbs-Dqzgh2Qe.js";function N(){const s=y(),{user:t}=z();return v({mutationKey:[T.PUT_SETTINGS],mutationFn:n=>t.updateSettings(n),onSettled:()=>{s.invalidateQueries()}})}const O=h.object({timezone:h.string()});function _({defaultValues:s}){return k({defaultValues:s,resolver:Q(O)})}function q(){const s=b(),t=U();return f.useMemo(()=>s.isLoading||t.isLoading?{status:"loading"}:s.isSuccess&&t.isSuccess?{status:"success",data:H({user:s.data,countryTimezones:t.data})}:{status:"error",retry:{onClick:()=>{s.refetch(),t.refetch()},isPending:s.isPending||t.isPending}},[s,t])}function H(s){return{settings:{timezone:s.user.timezone},countryTimezones:s.countryTimezones}}function I({countryTimezones:s,settings:t}){var m,d;const n=N(),{timezonesData:j}=B({countryTimezones:s}),r=_({defaultValues:{timezone:t.timezone}}),S=f.useCallback(o=>{n.mutate(o,{onSuccess:()=>{F.show({color:"green",title:"Updated",message:"Settings updated successfully"})},onError:l=>{if(!E(l)){r.setError("root",{message:"Something went wrong!"});return}L({axiosError:l,setError:r.setError})}})},[r,n]),u=r.formState.errors,c=(m=u.root)==null?void 0:m.message;return e.jsx(e.Fragment,{children:e.jsxs("form",{onSubmit:r.handleSubmit(S),children:[e.jsx(V,{size:"sm",label:"Timezone",...r.register("timezone"),onChange:o=>{o&&r.setValue("timezone",o)},value:r.watch("timezone"),data:j,error:(d=u.timezone)==null?void 0:d.message,searchable:!0}),c&&e.jsxs(e.Fragment,{children:[e.jsx(g,{h:"xl"}),e.jsx(R,{color:"pink",title:c})]}),e.jsx(g,{h:"xl"}),e.jsx(i,{justify:"end",children:e.jsx(A,{type:"submit",loading:n.isPending,children:"Update"})})]})})}function J(){return e.jsxs(i,{direction:"column",gap:"sm",children:[e.jsx(a,{h:36}),e.jsx(a,{h:36}),e.jsx(i,{justify:"end",children:e.jsx(a,{h:36,w:128})})]})}function W(){const{status:s,data:t,retry:n}=q();return e.jsxs(e.Fragment,{children:[e.jsx(i,{py:"md",align:"start",justify:"space-between",direction:{base:"column",sm:"row"},gap:"sm",children:e.jsxs(x,{children:[e.jsx(w,{size:"h2",order:4,children:"Settings"}),e.jsx(p,{size:"sm",c:"gray",fw:500,children:"Manage your account and preferences"})]})}),e.jsxs(x,{p:"md",withBorder:!0,flex:1,children:[s==="success"&&e.jsx(I,{settings:t.settings,countryTimezones:t.countryTimezones}),s==="error"&&e.jsx(D,{title:"Couldn't fetch settings",retry:n}),s==="loading"&&e.jsx(J,{})]})]})}function oe(){return e.jsxs(e.Fragment,{children:[e.jsxs(G,{children:[e.jsx(K,{component:M,to:C({type:P.DASHBOARD}),children:"Dashboard"}),e.jsx(p,{c:"violet",children:"Settings"})]}),e.jsx(W,{})]})}export{oe as default};
