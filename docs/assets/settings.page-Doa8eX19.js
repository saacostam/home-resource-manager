import{q as S,s as y,t as z,M as T,N as E,r as h,V as b,W as w,X as A,w as F,j as e,S as g,F as i,D as M,P as x,A as P,y as f,E as C,G as k,H as Q}from"./index-Dph-KdTA.js";import{u as R,a as U}from"./use-query-all-timezones-u65mPcMc.js";import{Q as v}from"./query-error-CNsdQYee.js";import{S as B}from"./Select-B0HnI243.js";import{A as D}from"./Alert-DxgmFpR2.js";import{S as a}from"./Skeleton-CJ5-Kzcs.js";import{B as L}from"./Breadcrumbs-BwGdq7gf.js";import{A as V}from"./Anchor-C7SuYMB3.js";function q(){const s=S(),{user:t}=y();return z({mutationKey:[T.PUT_SETTINGS],mutationFn:r=>t.updateSettings(r),onSettled:()=>{s.invalidateQueries()}})}function G(){const s=E(),t=R();return h.useMemo(()=>s.isLoading||t.isLoading?{status:"loading"}:s.isSuccess&&t.isSuccess?{status:"success",data:H({user:s.data,countryTimezones:t.data})}:{status:"error",retry:{onClick:()=>{s.refetch(),t.refetch()},isPending:s.isPending||t.isPending}},[s,t])}function H(s){return{settings:{timezone:s.user.timezone},countryTimezones:s.countryTimezones}}function K({countryTimezones:s,settings:t}){var m,d;const r=q(),{timezonesData:p}=U({countryTimezones:s}),n=b({defaultValues:{timezone:t.timezone}}),j=h.useCallback(o=>{r.mutate(o,{onSuccess:()=>{F.show({color:"green",title:"Updated",message:"Settings updated successfully"})},onError:l=>{if(!w(l)){n.setError("root",{message:"Something went wrong!"});return}A({axiosError:l,setError:n.setError})}})},[n,r]),u=n.formState.errors,c=(m=u.root)==null?void 0:m.message;return e.jsx(e.Fragment,{children:e.jsxs("form",{onSubmit:n.handleSubmit(j),children:[e.jsx(B,{size:"sm",label:"Timezone",...n.register("timezone"),onChange:o=>{o&&n.setValue("timezone",o)},value:n.watch("timezone"),data:p,error:(d=u.timezone)==null?void 0:d.message,searchable:!0}),c&&e.jsxs(e.Fragment,{children:[e.jsx(g,{h:"xl"}),e.jsx(D,{color:"pink",title:c})]}),e.jsx(g,{h:"xl"}),e.jsx(i,{justify:"end",children:e.jsx(M,{type:"submit",loading:r.isPending,children:"Update"})})]})})}function N(){return e.jsxs(i,{direction:"column",gap:"sm",children:[e.jsx(a,{h:36}),e.jsx(a,{h:36}),e.jsx(i,{justify:"end",children:e.jsx(a,{h:36,w:128})})]})}function O(){const{status:s,data:t,retry:r}=G();return e.jsxs(e.Fragment,{children:[e.jsx(i,{py:"md",align:"start",justify:"space-between",direction:{base:"column",sm:"row"},gap:"sm",children:e.jsxs(x,{children:[e.jsx(P,{size:"h2",order:4,children:"Settings"}),e.jsx(f,{size:"sm",c:"gray",fw:500,children:"Manage your account and preferences"})]})}),e.jsxs(x,{p:"md",withBorder:!0,flex:1,children:[s==="success"&&e.jsx(K,{settings:t.settings,countryTimezones:t.countryTimezones}),s==="error"&&e.jsx(v,{title:"Couldn't fetch settings",retry:r}),s==="loading"&&e.jsx(N,{})]})]})}function ee(){return e.jsxs(e.Fragment,{children:[e.jsxs(L,{children:[e.jsx(V,{component:k,to:C({type:Q.DASHBOARD}),children:"Dashboard"}),e.jsx(f,{c:"violet",children:"Settings"})]}),e.jsx(O,{})]})}export{ee as default};
